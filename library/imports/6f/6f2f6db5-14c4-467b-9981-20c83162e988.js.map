{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\loudly.js"],"names":["msg","require","cc","Class","extends","Component","properties","monsterA","Node","monsterB","muteButton","Button","micButton","logstr","Label","localUid","allUser","isColliding","onKeyUp","event","console","log","v2A","v2B","keyCode","macro","KEY","a","s","j","k","localVolume","remoteVolume","onLoad","systemEvent","on","SystemEvent","EventType","KEY_UP","initEvent","initSDK","AGROA_JOIN_CHANNEL_SUCCESS","onEvent","AGROA_INIT_SUCCESS","AGROA_AUDIO_VOLUME_INDICATION","removeEvent","off","eventData","data","type","agora","getVersion","startPlay","channel","uid","elapsed","string","push","userArray","speakers","stream","getAudioLevel","speakerNumber","volume","AGROA_USER_JOINED","AGROA_USER_OFFLINE","index","indexOf","splice","AGROA_LEAVE_CHANNEL","muteAllRemoteAudio","button","mutebutton","node","getChildByName","getComponent","flag","muteAllRemoteAudioStreams","muteLocalAudio","muteLocalAudioStream","action","moveBy","v2","runAction","setChannelProfile","enableAudioVolumeIndication","joinChannel","agoraAppID","response","prototype","bind","init","leaveRoom","leaveChannel","joinOverResponse","joinOverRsp","status","cpProto","start","onDestroy","update","dt","Math","abs","x"],"mappings":"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","file":"loudly.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nlet msg = require(\"SDKLib/SDKMessage\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        monsterA:cc.Node,\r\n        monsterB:cc.Node,\r\n        muteButton:cc.Button,\r\n        micButton:cc.Button,\r\n        logstr:cc.Label,\r\n        localUid:0,\r\n        allUser:[],\r\n        isColliding:false,\r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;jjjj\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    onKeyUp (event) {\r\n        // unset a flag when key released\r\n        console.log(\"onKeyDown:\", event);\r\n        var v2A = 0;\r\n        var v2B = 0;\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                v2A+=5;\r\n                v2B+=1;\r\n                break;\r\n            case cc.macro.KEY.s:\r\n                v2A+=3;\r\n                v2B+=1;\r\n                break;\r\n            case cc.macro.KEY.j:\r\n                v2B+=5;\r\n                v2A+=1;\r\n                break;\r\n            case cc.macro.KEY.k:\r\n                v2B+=3;\r\n                v2A+=1;\r\n            break;\r\n        }\r\n        if(this.isColliding){\r\n                this.localVolume(v2A-v2B);\r\n                this.remoteVolume(v2B-v2A);\r\n            }else{\r\n                this.localVolume(v2A);\r\n                this.remoteVolume(v2B);\r\n            }\r\n    },\r\n    onLoad () {\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this);\r\n        this.initEvent();\r\n        this.initSDK();\r\n    },\r\n    /**\r\n     * 注册对应的事件监听和把自己的原型传递进入，用于发送事件使用\r\n     */\r\n    initEvent:function () {\r\n        cc.systemEvent.on(msg.AGROA_JOIN_CHANNEL_SUCCESS,this.onEvent,this);\r\n        cc.systemEvent.on(msg.AGROA_INIT_SUCCESS,this.onEvent,this);\r\n        cc.systemEvent.on(msg.AGROA_AUDIO_VOLUME_INDICATION,this.onEvent,this);\r\n    },\r\n    removeEvent:function () {\r\n        cc.systemEvent.off(msg.AGROA_JOIN_CHANNEL_SUCCESS,this.onEvent,this);\r\n        cc.systemEvent.off(msg.AGROA_INIT_SUCCESS,this.onEvent,this);\r\n        cc.systemEvent.off(msg.AGROA_AUDIO_VOLUME_INDICATION,this.onEvent,this);\r\n    },\r\n    /**\r\n     * 事件接收方法\r\n     * @param event\r\n     */\r\n    onEvent:function (event) {\r\n        let eventData = event.data;\r\n        switch (event.type){\r\n            case msg.AGROA_INIT_SUCCESS:\r\n                console.log(\"init success version:\"+agora.getVersion());\r\n                this.startPlay();\r\n                break;\r\n            case msg.AGROA_JOIN_CHANNEL_SUCCESS:\r\n                console.log(\"event_JOIN_CHANNEL_SUCCESS_channel: \" + eventData.channel + \" uid: \" + eventData.uid + \" elapsed: \" + eventData.elapsed);\r\n                this.logstr.string = \"channel: \" + eventData.channel + \" uid: \" + eventData.uid ;\r\n                this.localUid = eventData.uid;\r\n                this.allUser.push(eventData.uid);\r\n                this.isColliding = false;\r\n                break;\r\n            case msg.AGROA_AUDIO_VOLUME_INDICATION:\r\n                var userArray = eventData.speakers;\r\n                var v2A = agora.stream.getAudioLevel()*100;\r\n                var v2B = 0;\r\n                if(eventData.speakerNumber>0)\r\n                    v2B = userArray[0].volume;\r\n                    console.log(\"v2A = \" + v2A\r\n                    +\"  v2B = \" + v2B);    \r\n                if(this.isColliding){\r\n                    this.localVolume(v2A-v2B);\r\n                    this.remoteVolume(v2B-v2A);\r\n                }else{\r\n                    this.localVolume(v2A);\r\n                    this.remoteVolume(v2B);\r\n                }\r\n                break;\r\n            case msg.AGROA_USER_JOINED:\r\n            this.allUser.push(eventData.uid);\r\n             break;\r\n            case msg.AGROA_USER_OFFLINE:\r\n                var index = this.allUser.indexOf(eventData.uid);\r\n                if(index>=0){\r\n                    this.allUser.splice(index, 1); \r\n                }\r\n                break;\r\n            case msg.AGROA_LEAVE_CHANNEL:\r\n                var index = this.allUser.indexOf(eventData.uid);\r\n                this.allUser.splice(index, 1); \r\n            default:\r\n            console.log(event.type,event);\r\n            }\r\n    },\r\n    /*indexOf: function(list,val) { \r\n    for (var i = 0; i < list.length; i++) { \r\n    if (list[i] == val) return i; \r\n    } \r\n    return -1; \r\n    },*/\r\n    muteAllRemoteAudio:function(){\r\n        let button = this.mutebutton.node.getChildByName(\"Label\").getComponent(cc.Label);\r\n        var flag = button.string == \"静音\";\r\n        button.string = flag?\"播音\":\"静音\";\r\n        agora.muteAllRemoteAudioStreams(!flag);\r\n    },\r\n    muteLocalAudio:function(){\r\n        let button = this.micButton.node.getChildByName(\"Label\").getComponent(cc.Label);\r\n        var flag = button.string == \"关麦\";\r\n        button.string = flag?\"开麦\":\"关麦\";\r\n        agora.muteLocalAudioStream(!flag);\r\n    },\r\n    localVolume:function(volume){\r\n        console.log(\"localVolume = \" + volume);\r\n        var action = cc.moveBy(0.2, cc.v2(volume*5,0));\r\n        this.monsterA.runAction(action);\r\n    },\r\n    remoteVolume:function(volume,uid){\r\n        console.log(\"remoteVolume = \" + volume);\r\n        var action = cc.moveBy(0.2, cc.v2(volume*-5,0));\r\n        this.monsterB.runAction(action);\r\n    },\r\n\r\n    /**\r\n     * 登录\r\n     * @param id\r\n     * @param token\r\n     */\r\n    startPlay: function () {\r\n        console.log(\"startPlay\");\r\n\r\n        agora.setChannelProfile(0);\r\n        agora.enableAudioVolumeIndication(50, 3);\r\n        agora.joinChannel(\"\", \"acgzq1\");\r\n       /* if(this.mvToken!=null&&this.mvUserID!=null){\r\n            GLB.userID = this.mvUserID;\r\n            engine.prototype.login(this.mvUserID,this.mvToken);\r\n        }else{\r\n            engine.prototype.registerUser();\r\n        }*/\r\n        \r\n    },\r\n     initSDK(){\r\n        console.log(\"调用初始化\");\r\n        var agoraAppID = \"59dd6d4438a54c36b9ed7425795f3374\";\r\n        response.prototype.bind();\r\n        agora.init(agoraAppID);\r\n        \r\n    },\r\n\r\n    leaveRoom:function(){\r\n        agora.leaveChannel();\r\n    },\r\n    joinOverResponse:function(joinOverRsp){\r\n        // 返回值\r\n        console.log(\"加入房间结果：\", joinOverRsp.status);\r\n        // 负载数据\r\n        console.log(\"负载信息：\", joinOverRsp.cpProto);\r\n        console.log(\"加入房间结果：\" + joinOverRsp.status + \"\\n负载信息：\" + joinOverRsp.cpProto);\r\n    },\r\n    start () {\r\n\r\n    },\r\n    /**\r\n     * 生命周期，销毁\r\n     */\r\n    onDestroy () {\r\n        this.removeEvent();\r\n        console.log(\"main 页面销毁\");\r\n    },\r\n\r\n     update (dt) {\r\n        if(Math.abs(this.monsterA.x-this.monsterB.x)<=78){\r\n            this.isColliding = true;\r\n        }else{\r\n            this.isColliding = false;\r\n        }\r\n     },\r\n});\r\n"]}