{"version":3,"sources":["monster.js"],"names":["objectPool","require","mathUtil","AI","cc","Class","extends","Component","properties","starSprite","Node","starPrefab","default","type","Prefab","monsterSprite","radius","kai","playId","initialStarNo","totalStar","moveSpeedX","moveSpeedY","moveLeft","moveBottom","moveRight","moveTop","gameOver","onKeyDown","event","console","log","keyCode","macro","KEY","a","d","g","h","node","getComponent","tag","i","children","length","j","starPool","put","k","runAction","moveBy","v2","l","onKeyUp","spawnNewStar","r","removeAllStar","b","boomAnimation","Animation","number","active","play","minusStar","angle","x1","Math","cos","PI","y1","sin","newStar","createStar","addChild","setPosition","monster","game","reArrangeStar","len","star","action","moveTo","getNewStarPosition","onLoad","manager","director","getCollisionManager","enabled","systemEvent","on","SystemEvent","EventType","KEY_DOWN","KEY_UP","schedule","runRoundCallback","start","onEnable","rotateBy","callback","callFunc","sequence","repeat","AiOn","ai","setMap","setEnemy","allPlay","setSelf","startControl","onCollisionEnter","other","self","getAngle","getPosition","finishPlay","destroy","onCollisionStay","onCollisionExit","move","update","dt","posX","x","posY","y"],"mappings":"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","file":"monster.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nlet objectPool = require(\"util/objectPool\");\r\nlet mathUtil = require(\"util/mathUtil\");\r\nlet AI = require(\"AI\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        starSprite:cc.Node,\r\n        starPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        monsterSprite:cc.Node,\r\n        radius:150,\r\n        kai:0,\r\n        playId:0,\r\n        initialStarNo:0,\r\n        totalStar:0,\r\n        moveSpeedX:0,\r\n        moveSpeedY:0,\r\n        moveLeft : true,\r\n        moveBottom : true,\r\n        moveRight : true,\r\n        moveTop : true,\r\n        gameOver:false,\r\n        \r\n        \r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n    onKeyDown (event) {\r\n        // set a flag when key pressed\r\n        console.log(\"onKeyDown:\", event);\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                \r\n                break;\r\n            case cc.macro.KEY.d:\r\n                \r\n                break;\r\n            case cc.macro.KEY.g:\r\n                break;\r\n            case cc.macro.KEY.h:\r\n            console.log('this.node..Collider=',this.node.getComponent('cc.Collider').tag);\r\n            for(var i = 0;i< this.starSprite.children.length;i++){\r\n                console.log('star.tag='+this.starSprite.children[i].getComponent('cc.Collider').tag);\r\n            }\r\n            \r\n                break;\r\n            case cc.macro.KEY.j:\r\n                objectPool.starPool.put(this.starSprite.children[0]);\r\n                break;\r\n            case cc.macro.KEY.k:\r\n                this.node.runAction(cc.moveBy(0.5,cc.v2(15,0)));\r\n                break;\r\n            case cc.macro.KEY.l:\r\n                this.node.runAction(cc.moveBy(0.5,cc.v2(-15,15)));\r\n                break;\r\n        }\r\n    },\r\n   \r\n    onKeyUp (event) {\r\n        // unset a flag when key released\r\n        console.log(\"onKeyUp:\", event);\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.a:\r\n                this.spawnNewStar(1);\r\n                break;\r\n                case cc.macro.KEY.r:\r\n                this.removeAllStar();\r\n                break;\r\n            case cc.macro.KEY.b:\r\n                var boomAnimation = this.monsterSprite.getComponent(cc.Animation);\r\n                boomAnimation.gameOver = function(number){\r\n                    console.log(\"gameOver\", number);\r\n                    boomAnimation.active = false;\r\n                };\r\n                boomAnimation.play('boom');\r\n                break;\r\n        }\r\n    },\r\n    minusStar:function(){\r\n      /*  var newStar = this.starArray.pop();\r\n        newStar.parent = this.node.parent;\r\n        var ox = this.node.x;\r\n        var action = cc.moveTo(0.5, cc.v2(x1,y1));\r\n        this.newStar.runAction(action);*/\r\n    },\r\n    spawnNewStar: function(number) {\r\n        console.log(\"monster\"+this.node.getComponent('cc.Collider').tag+\" spawnNewStar:\",  number);\r\n        var angle = 0;\r\n        if(number>0){\r\n            angle = 360/number; \r\n        }\r\n        for(var i = 0;i<number;i++){\r\n            var x1 = this.radius * Math.cos(angle * i * Math.PI / 180);\r\n            var y1 = this.radius * Math.sin(angle * i * Math.PI / 180);\r\n            // 使用给定的模板在场景中生成一个新节点\r\n            var newStar = objectPool.createStar(this.starPrefab);//cc.instantiate(this.starPrefab);\r\n            \r\n            //this.starArray.push(newStar);\r\n            // 将新增的节点添加到 starSprite 节点上面\r\n            //console.log(\" this.starSprite:\",  this.starSprite);\r\n            this.starSprite.addChild(newStar);\r\n            newStar.getComponent('cc.Collider').tag = this.node.getComponent('cc.Collider').tag-10;\r\n            console.log(\" newStar.getComponent('cc.Collider').tag=\",  newStar.getComponent('cc.Collider').tag);\r\n            newStar.setPosition(cc.v2(x1, y1));\r\n            newStar.getComponent('star').monster = this;\r\n            newStar.getComponent('star').game = this.game;\r\n        }\r\n        //this.reArrangeStar();\r\n    },\r\n    reArrangeStar(){\r\n        var len = this.starSprite.children.length;\r\n        this.totalStar = len;\r\n        var angle = 0;\r\n        if(len>0){\r\n            angle = 360/len; \r\n            //console.log(\"angle =\"+angle); \r\n        }\r\n        for(var i = 0; i < len; i++){\r\n            var x1 = this.radius * Math.cos(angle * i * Math.PI / 180);\r\n            var y1 = this.radius * Math.sin(angle * i * Math.PI / 180);\r\n           // console.log(\"x =\"+x1+\"y\"+y1);\r\n            //this.starArray[i].getComponent('star').angle = angle * i;\r\n            let star = this.starSprite.children[i];\r\n            star.getComponent('cc.Collider').tag = this.node.getComponent('cc.Collider').tag-10;\r\n            star.getComponent('star').angle = angle * i;\r\n            var action = cc.moveTo(0.5, cc.v2(x1,y1));\r\n            star.runAction(action);//this.starSprite.children[i].runAction(action);\r\n        }\r\n            \r\n    },\r\n    getNewStarPosition(){\r\n        return cc.v2(150, 0);\r\n    },\r\n    removeAllStar(){\r\n        var len = this.starSprite.children.length;\r\n        for(var i = 0; i < len; i++){\r\n            console.log('removeStar:' , i);\r\n           objectPool.starPool.put(this.starSprite.children[i]);\r\n        }\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n     onLoad () {\r\n        console.log('monster onLoad');\r\n        var manager = cc.director.getCollisionManager();\r\n        manager.enabled = true;\r\n        // 初始化键盘输入监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDown, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUp, this); \r\n       /* for(var i = 0;i<this.initialStarNo;i++){\r\n            this.spawnNewStar();\r\n        }*/\r\n        this.schedule(function() {\r\n            this.reArrangeStar();\r\n            /*if(this.totalStar != this.starSprite.children.length){\r\n                this.reArrangeStar();\r\n            }*/\r\n        }, 0.5); \r\n         \r\n     },\r\n   \r\n    runRoundCallback:function(){\r\n        this.kai+=1;\r\n       // console.log(\"the\"+this.kai+\"round\");\r\n    },\r\n    start () {\r\n        \r\n    },\r\n    onEnable(){\r\n        console.log('onEnable');\r\n        this.gameOver = false;\r\n        \r\n        this.spawnNewStar(this.initialStarNo);\r\n        var action = cc.rotateBy(3,360);\r\n        var callback = cc.callFunc(this.runRoundCallback,this);\r\n        var sequence = cc.sequence(action,callback);\r\n        this.starSprite.runAction(cc.repeat(sequence,999));\r\n        this.moveSpeedX = 0;\r\n        this.moveSpeedY = 0;   \r\n         \r\n    },\r\n    AiOn(){\r\n        var ai = new AI();\r\n            ai.setMap(this.game);\r\n            ai.setEnemy(this.game.getComponent('game').allPlay[0]);\r\n            ai.setSelf(this);\r\n            ai.startControl();\r\n    },\r\n    /**\r\n     * 当碰撞产生的时候调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\r\n    onCollisionEnter: function (other, self) {\r\n        console.log('on collision enter');\r\n       // console.log('self=' , self);\r\n       // console.log('other=' , other);\r\n        if(self.tag-10 == other.tag || this.gameOver)//同属的,或者游戏结束 就不管了\r\n            return;\r\n        if(other.tag == 20 ){\r\n           var angle = mathUtil.getAngle(other.node.getPosition(),self.node.getPosition());\r\n           console.log('angle=' +angle);\r\n           if(angle>=45 && angle<135){\r\n                this.moveBottom = false;\r\n            }else if(angle>=135 && angle<225){\r\n                this.moveRight = false;\r\n            }else if(angle>=225 && angle<315){\r\n                this.moveTop = false;\r\n            }else{\r\n                this.moveLeft = false;\r\n            }\r\n        }else if(other.tag < 10 && other.tag >= 0){//撞到别人家的星星\r\n          // console.log('撞到别人家的星星=',other);\r\n          // console.log('this.node.=',this.node.getComponent('cc.Collider').tag);\r\n          // for(var i = 0;i< this.starSprite.children.length;i++){\r\n           //    console.log('star.tag='+this.starSprite.children[i].getComponent('cc.Collider').tag);\r\n           //}\r\n            this.removeAllStar();\r\n            this.gameOver = true;\r\n            this.game.finishPlay(self.tag);\r\n            var self = this;\r\n            var boomAnimation = this.monsterSprite.getComponent(cc.Animation);\r\n               // console.log(\"cc.macro.KEY.b:\", boomAnimation);\r\n                boomAnimation.gameOver = function(number){\r\n                    console.log(\"gameOver\", number);\r\n                    boomAnimation.active = false;\r\n                    //objectPool.recoveryPlay(self.node);\r\n                    self.node.destroy();\r\n                    \r\n                };\r\n                boomAnimation.play('boom');\r\n        }\r\n            \r\n\r\n    },\r\n    /**\r\n     * 当碰撞产生后，碰撞结束前的情况下，每次计算碰撞结果后调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\r\n    onCollisionStay: function (other, self) {\r\n        //console.log('on collision stay');\r\n        if(other.tag == 20 ){\r\n            var angle = mathUtil.getAngle(other.node.getPosition(),self.node.getPosition());\r\n           // console.log('angle=' +angle);\r\n            if(angle>=45 && angle<135){\r\n                 this.moveBottom = false;\r\n             }else if(angle>=135 && angle<225){\r\n                 this.moveRight = false;\r\n             }else if(angle>=225 && angle<315){\r\n                 this.moveTop = false;\r\n             }else{\r\n                 this.moveLeft = false;\r\n             }\r\n         }\r\n    },\r\n    /**\r\n     * 当碰撞结束后调用\r\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\r\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\r\n     */\r\n    onCollisionExit: function (other, self) {\r\n        console.log('on collision exit');\r\n        this.moveLeft = true;\r\n        this.moveBottom = true;\r\n        this.moveRight = true;\r\n        this.moveTop = true;\r\n    },\r\n    move(moveSpeedX,moveSpeedY){\r\n        this.moveSpeedX = moveSpeedX;\r\n        this.moveSpeedY = moveSpeedY;   \r\n         \r\n    },\r\n\r\n     update (dt) {\r\n         //if(this.isCurrentPlayer){\r\n\r\n            if(this.moveSpeedX>0 && !this.moveRight || this.moveSpeedX<0 && !this.moveLeft){\r\n                this.moveSpeedX = 0;\r\n            }\r\n            if(this.moveSpeedY>0 && !this.moveTop || this.moveSpeedY<0 && !this.moveBottom){\r\n                this.moveSpeedY = 0;\r\n            }\r\n            var posX = this.node.x + this.moveSpeedX;\r\n            var posY = this.node.y + this.moveSpeedY;\r\n            if(posX>640 || posX<-640){\r\n                posX = this.node.x;\r\n            }\r\n            if(posY>640 || posY < -640){\r\n                posY = this.node.y;\r\n            }\r\n        \r\n            this.node.setPosition(new cc.v2(posX,posY));\r\n       // }\r\n     },\r\n});\r\n"]}