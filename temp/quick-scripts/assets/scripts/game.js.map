{"version":3,"sources":["game.js"],"names":["mathUtil","require","objectPool","cc","Class","extends","Component","properties","bg","Node","camera","monster","monsterScript","controlOrignPosX","controlOrignPosY","moveSpeedX","moveSpeedY","fastSpeed","starPrefab","default","type","Prefab","monsterPrefab","obstacle1","obstacle2","obstacle3","totalPlay","allPlay","allStar","play1Stars","playNo","gameOver","standing","resultLabel","Label","onLoad","console","log","string","node","getChildByName","on","EventType","TOUCH_MOVE","touchMove","TOUCH_START","touchStart","TOUCH_END","touchEnd","TOUCH_CANCEL","initGame","reStarGame","length","i","undefined","isValid","destroy","setPosition","v2","director","loadScene","start","self","schedule","children","star","getComponent","tag","onDestroy","createMonster","isCurrentPlayer","getPosition","AiOn","ii","createStar","createPlay","addChild","game","pos","getRandomPosition","play","getDistance","e","x","y","w","h","positionX","Math","floor","random","positionY","newV2","updataMonsterStar","reArrangeStar","event","getLocationX","getLocationY","move","addStarToMonster","addStar","update","dt","finishPlay","splice","scheduleOnce","recoveryStar","action","moveTo","convertToWorldSpaceAR","runAction"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAIA,WAAWC,QAAQ,eAAR,CAAf;AACA,IAAIC,aAAaD,QAAQ,iBAAR,CAAjB;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,YAAGL,GAAGM,IADE;AAERC,gBAAOP,GAAGM,IAFF;AAGRE,iBAAQR,GAAGM,IAHH;AAIRG,uBAAcT,GAAGM,IAJT;AAKRI,0BAAiB,CALT;AAMRC,0BAAiB,CANT;AAORC,oBAAW,CAPH;AAQRC,oBAAW,CARH;AASRC,mBAAU,CATF;AAURC,oBAAY;AACRC,qBAAS,IADD;AAERC,kBAAMjB,GAAGkB;AAFD,SAVJ;AAcRC,uBAAc;AACVH,qBAAS,IADC;AAEVC,kBAAMjB,GAAGkB;AAFC,SAdN;AAkBRE,mBAAUpB,GAAGM,IAlBL;AAmBRe,mBAAUrB,GAAGM,IAnBL;AAoBRgB,mBAAUtB,GAAGM,IApBL;AAqBRiB,mBAAU,CArBF;AAsBRC,iBAAQ,CAACxB,GAAGkB,MAAJ,CAtBA;AAuBRO,iBAAQ,CAACzB,GAAGkB,MAAJ,CAvBA;AAwBRQ,oBAAW,CAAC1B,GAAGkB,MAAJ,CAxBH;AAyBRS,gBAAO,CAzBC;AA0BRC,kBAAS,KA1BD;AA2BRC,kBAAS7B,GAAGM,IA3BJ;AA4BRwB,qBAAY9B,GAAG+B;AACf;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA7CQ,KAHP;;AAmDL;;AAECC,UArDI,oBAqDM;AACPC,gBAAQC,GAAR,CAAY,aAAZ;AACA,aAAKJ,WAAL,CAAiBK,MAAjB,GAA0B,UAA1B;AACA,aAAKC,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,EAAvC,CAA0CtC,GAAGM,IAAH,CAAQiC,SAAR,CAAkBC,UAA5D,EAAwE,KAAKC,SAA7E,EAAwF,IAAxF;AACA,aAAKL,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,EAAvC,CAA0CtC,GAAGM,IAAH,CAAQiC,SAAR,CAAkBG,WAA5D,EAAyE,KAAKC,UAA9E,EAA0F,IAA1F;AACA,aAAKP,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,EAAvC,CAA0CtC,GAAGM,IAAH,CAAQiC,SAAR,CAAkBK,SAA5D,EAAsE,KAAKC,QAA3E,EAAoF,IAApF;AACA,aAAKT,IAAL,CAAUC,cAAV,CAAyB,YAAzB,EAAuCC,EAAvC,CAA0CtC,GAAGM,IAAH,CAAQiC,SAAR,CAAkBO,YAA5D,EAAyE,KAAKD,QAA9E,EAAuF,IAAvF;AACA,aAAKE,QAAL;AACH,KA7DI;AA8DLC,cA9DK,wBA8DO;AACR,aAAKpB,QAAL,GAAiB,KAAjB;AACAK,gBAAQC,GAAR,CAAY,sBAAZ,EAAmC,KAAKV,OAAL,CAAayB,MAAhD;AACA,aAAI,IAAIC,IAAI,CAAZ,EAAcA,IAAI,KAAK1B,OAAL,CAAayB,MAA/B,EAAuCC,GAAvC,EAA2C;AACvC,gBAAI1C,UAAU,KAAKgB,OAAL,CAAa0B,CAAb,CAAd;AACA,gBAAG1C,WAAS,IAAT,IAAiBA,WAAU2C,SAA3B,IAAwC,CAAC3C,QAAQ4C,OAApD,EAA4D;AACxD;AACD;AACA5C,wBAAQ6C,OAAR;AACF;AAEJ;AACD,aAAKxB,QAAL,CAAcyB,WAAd,CAA0BtD,GAAGuD,EAAH,CAAM,GAAN,EAAU,IAAV,CAA1B;AACAvD,WAAGwD,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,KA5EI;AA6ELC,SA7EK,mBA6EI;AACL,YAAIC,OAAO,IAAX;AACA,aAAKC,QAAL,CAAc,YAAI;AACd,gBAAIvD,KAAIsD,KAAKvB,IAAL,CAAUyB,QAAV,CAAmB,CAAnB,CAAR;AACA,iBAAI,IAAIX,IAAI,CAAZ,EAAeA,IAAE7C,GAAGwD,QAAH,CAAYZ,MAA7B,EAAqCC,GAArC,EAAyC;AACrC,oBAAIY,OAAOzD,GAAGwD,QAAH,CAAYX,CAAZ,CAAX;AACAY,qBAAKC,YAAL,CAAkB,aAAlB,EAAiCC,GAAjC,GAAuC,CAAC,CAAxC;AACH;AACJ,SAND,EAMG,CANH;AAOH,KAtFI;;AAuFL;;;AAGAC,aA1FK,uBA0FM,CAAE,CA1FR;AA2FLlB,YA3FK,sBA2FK;AACNd,gBAAQC,GAAR,CAAY,UAAZ;AACA,aAAI,IAAIgB,IAAI,CAAZ,EAAcA,IAAI,KAAK3B,SAAvB,EAAkC2B,GAAlC,EAAsC;;AAElC,iBAAK1B,OAAL,CAAa0B,CAAb,IAAkB,KAAKgB,aAAL,CAAmB,KAAGhB,CAAtB,CAAlB;AACA,gBAAGA,KAAK,KAAKvB,MAAb,EAAoB;AAChB,qBAAKnB,OAAL,GAAe,KAAKgB,OAAL,CAAa0B,CAAb,CAAf;AACA,qBAAKzC,aAAL,GAAqB,KAAKD,OAAL,CAAauD,YAAb,CAA0B,SAA1B,CAArB;AACA,qBAAKtD,aAAL,CAAmB0D,eAAnB,GAAqC,IAArC;AACA,qBAAK5D,MAAL,CAAY+C,WAAZ,CAAwB,KAAK9C,OAAL,CAAa4D,WAAb,EAAxB;AACH,aALD,MAKK;AACD,qBAAK5C,OAAL,CAAa0B,CAAb,EAAgBa,YAAhB,CAA6B,SAA7B,EAAwCM,IAAxC;AACH;AACJ;AACA;AACD,aAAI,IAAIC,KAAK,CAAb,EAAeA,KAAK,EAApB,EAAwBA,IAAxB,EAA6B;AAC1B,iBAAK7C,OAAL,CAAa6C,EAAb,IAAmB,KAAKC,UAAL,EAAnB;AACF;AACJ,KA7GI;;AA8GLL,mBAAc,uBAASF,GAAT,EAAa;AACvB,YAAIxD,UAAU,IAAd;AACAA,kBAAWT,WAAWyE,UAAX,CAAsB,KAAKrD,aAA3B,CAAX;AACA,aAAKiB,IAAL,CAAUqC,QAAV,CAAmBjE,OAAnB;AACAA,gBAAQuD,YAAR,CAAqB,aAArB,EAAoCC,GAApC,GAA0CA,GAA1C;AACAxD,gBAAQuD,YAAR,CAAqB,SAArB,EAAgCW,IAAhC,GAAuC,IAAvC;;AAEA,YAAG,KAAKlD,OAAL,CAAayB,MAAb,GAAoB,CAAvB,EAAyB;AACrB,gBAAI0B,MAAM,KAAKC,iBAAL,CAAuB,CAAvB,EAAyB,CAAzB,EAA2B,IAA3B,EAAgC,IAAhC,CAAV;AACA,iBAAI,IAAI1B,IAAI,CAAZ,EAAcA,IAAE,KAAK1B,OAAL,CAAayB,MAA7B,EAAoCC,GAApC,EAAwC;AACpC,oBAAI2B,OAAO,KAAKrD,OAAL,CAAa0B,CAAb,CAAX;AACA,uBAAMrD,SAASiF,WAAT,CAAqBH,GAArB,EAAyBE,KAAKT,WAAL,EAAzB,IAA6C,GAAnD,EAAuD;AACnDO,0BAAM,KAAKC,iBAAL,CAAuB,CAAvB,EAAyB,CAAzB,EAA2B,IAA3B,EAAgC,IAAhC,CAAN;AACH;AAEJ;AACJ,SATD,MASK;AACDpE,oBAAQ8C,WAAR,CAAoB,KAAKsB,iBAAL,CAAuB,CAAvB,EAAyB,MAAI,OAAKZ,MAAI,EAAT,CAA7B,EAA0C,IAA1C,EAA+C,GAA/C,CAApB;AACH;AACD;AACA,eAAOxD,OAAP;AACH,KAnII;AAoIL+D,gBAAW,sBAAU;AACjB,YAAIT,OAAO,IAAX;AACAA,eAAO/D,WAAWwE,UAAX,CAAsB,KAAKxD,UAA3B,CAAP;AACA,YAAI;AACJ,iBAAKV,EAAL,CAAQoE,QAAR,CAAiBX,IAAjB;AACC,SAFD,CAEC,OAAMiB,CAAN,EAAQ;AACL,mBAAOjB,IAAP;AACH;AACDA,aAAKC,YAAL,CAAkB,aAAlB,EAAiCC,GAAjC,GAAuC,CAAC,CAAxC;AACAF,aAAKC,YAAL,CAAkB,MAAlB,EAA0BW,IAA1B,GAAiC,IAAjC;AACAZ,aAAKR,WAAL,CAAiB,KAAKsB,iBAAL,CAAuB,CAAvB,EAAyB,CAAzB,EAA2B,IAA3B,EAAgC,IAAhC,CAAjB;AACA,eAAOd,IAAP;AACH,KAhJI;AAiJLc,uBAAkB,2BAASI,CAAT,EAAWC,CAAX,EAAaC,CAAb,EAAeC,CAAf,EAAiB;AAC/B,YAAIC,YAAYC,KAAKC,KAAL,CAAWN,IAAE,CAACK,KAAKE,MAAL,KAAc,GAAf,IAAoBL,CAAjC,CAAhB;AACA,YAAIM,YAAYH,KAAKC,KAAL,CAAWL,IAAE,CAACI,KAAKE,MAAL,KAAc,GAAf,IAAoBJ,CAAjC,CAAhB;AACA,YAAIM,QAAQzF,GAAGuD,EAAH,CAAM6B,SAAN,EAAiBI,SAAjB,CAAZ;AACA,YAAG3F,SAASiF,WAAT,CAAqBW,KAArB,EAA2B,KAAKrE,SAAL,CAAegD,WAAf,EAA3B,IAAyD,GAAzD,IACDvE,SAASiF,WAAT,CAAqBW,KAArB,EAA2B,KAAKpE,SAAL,CAAe+C,WAAf,EAA3B,IAAyD,GADxD,IAEDvE,SAASiF,WAAT,CAAqBW,KAArB,EAA2B,KAAKnE,SAAL,CAAe8C,WAAf,EAA3B,IAAyD,GAF3D,EAE+D;AAC3D,mBAAO,KAAKQ,iBAAL,CAAuBI,CAAvB,EAAyBC,CAAzB,EAA2BC,CAA3B,EAA6BC,CAA7B,CAAP;AACH,SAJD,MAIK;AACD,mBAAOM,KAAP;AACH;AAEJ,KA7JI;AA8JLC,qBA9JK,6BA8Ja1B,GA9Jb,EA8JiB;AAClB/B,gBAAQC,GAAR,CAAY,oBAAZ,EAAiC8B,GAAjC;AACA,aAAKxC,OAAL,CAAawC,GAAb,EAAkBD,YAAlB,CAA+B,SAA/B,EAA0C4B,aAA1C;AACH,KAjKI;;AAkKLhD,gBAAW,oBAASiD,KAAT,EAAe;AACtB3D,gBAAQC,GAAR,CAAY,KAAZ;AACA,aAAKxB,gBAAL,GAAwBkF,MAAMC,YAAN,EAAxB;AACA,aAAKlF,gBAAL,GAAwBiF,MAAME,YAAN,EAAxB;AACH,KAtKI;AAuKLrD,eAAU,mBAASmD,KAAT,EAAe;;AAErB,YAAG,KAAKpF,OAAL,IAAgB,IAAhB,IAAwB,KAAKA,OAAL,IAAe2C,SAA1C,EAAoD;AAChD,gBAAG,KAAKvB,QAAR,EAAiB;AACb,qBAAKnB,aAAL,CAAmBsF,IAAnB,CAAwB,CAAxB,EAA0B,CAA1B;AACH,aAFD,MAEK;AACD,qBAAKnF,UAAL,GAAkB,CAACgF,MAAMC,YAAN,KAAuB,KAAKnF,gBAA7B,IAA+C,EAAjE;AACA,oBAAG,KAAKE,UAAL,GAAkB,KAAKE,SAA1B,EAAoC;AAC5B,yBAAKF,UAAL,GAAkB,KAAKE,SAAvB;AACP,iBAFD,MAEM,IAAG,KAAKF,UAAL,GAAkB,KAAKE,SAAL,GAAe,CAAC,CAArC,EAAuC;AACrC,yBAAKF,UAAL,GAAkB,KAAKE,SAAL,GAAe,CAAC,CAAlC;AACP;AACD,qBAAKD,UAAL,GAAkB,CAAC+E,MAAME,YAAN,KAAuB,KAAKnF,gBAA7B,IAA+C,EAAjE;AACA,oBAAG,KAAKE,UAAL,GAAgB,KAAKC,SAAxB,EAAkC;AAC9B,yBAAKD,UAAL,GAAkB,KAAKC,SAAvB;AACH,iBAFD,MAEM,IAAG,KAAKD,UAAL,GAAkB,KAAKC,SAAL,GAAe,CAAC,CAArC,EAAuC;AACzC,yBAAKD,UAAL,GAAkB,KAAKC,SAAL,GAAe,CAAC,CAAlC;AACH;AACD,qBAAKL,aAAL,CAAmBsF,IAAnB,CAAwB,KAAKnF,UAA7B,EAAwC,KAAKC,UAA7C;AACH;AAEJ;AAEJ,KA9LI;AA+LLgC,cAAS,kBAAS+C,KAAT,EAAe;AACpB,YAAG,KAAKpF,OAAL,IAAgB,IAAhB,IAAwB,KAAKA,OAAL,IAAe2C,SAA1C,EAAoD;AAChD,iBAAKvC,UAAL,GAAkB,CAAlB;AACA,iBAAKC,UAAL,GAAkB,CAAlB;AACA,iBAAKJ,aAAL,CAAmBsF,IAAnB,CAAwB,KAAKnF,UAA7B,EAAwC,KAAKC,UAA7C;AACH;AACJ,KArMI;AAsMLmF,oBAtMK,4BAsMY5D,IAtMZ,EAsMiB4B,GAtMjB,EAsMqB;AACtB,aAAKxD,OAAL,CAAauD,YAAb,CAA0B,SAA1B,EAAqCkC,OAArC,CAA6C7D,IAA7C;AACH,KAxMI;AAyMJ8D,UAzMI,kBAyMIC,EAzMJ,EAyMQ;AACZ;AACC;;AAEA;;;;;;;;;AASE;AACA;AACA,YAAG,KAAK3F,OAAL,IAAgB,IAAhB,IAAwB,KAAKA,OAAL,IAAe2C,SAA1C,EAAoD;AAChD,iBAAK5C,MAAL,CAAY+C,WAAZ,CAAwB,KAAK9C,OAAL,CAAa4D,WAAb,EAAxB;AACH;AAEJ,KA5NI;AA6NLgC,cA7NK,sBA6NMpC,GA7NN,EA6NU;AACX/B,gBAAQC,GAAR,CAAY,MAAZ,EAAmB8B,GAAnB;AACA,aAAKxC,OAAL,CAAa6E,MAAb,CAAoBrC,MAAI,EAAxB,EAA2B,CAA3B;AACA,YAAG,KAAKpC,QAAR,EACI;AACJ,YAAI+B,OAAO,IAAX;AACA,aAAK/B,QAAL,GAAgB,IAAhB;AACA,aAAK0E,YAAL,CAAkB,YAAW;AACzB,iBAAI,IAAIpD,IAAI,CAAZ,EAAcA,IAAES,KAAKtD,EAAL,CAAQwD,QAAR,CAAiBZ,MAAjC,EAAwCC,GAAxC,EAA4C;AACxCnD,2BAAWwG,YAAX,CAAwB5C,KAAKtD,EAAL,CAAQwD,QAAR,CAAiBX,CAAjB,CAAxB;AACH;;AAEDjB,oBAAQC,GAAR,CAAY,UAAQ8B,GAAR,GAAY,eAAZ,GAA4BL,KAAKhC,MAA7C;AACA,gBAAGgC,KAAKnC,OAAL,CAAayB,MAAb,IAAuB,CAA1B,EAA4B;AACxBhB,wBAAQC,GAAR,CAAY,YAAZ;AACAyB,qBAAK7B,WAAL,CAAiBK,MAAjB,GAA0B,YAA1B;AACH,aAHD,MAGM,IAAG6B,OAAOL,KAAKhC,MAAL,GAAY,EAAtB,EAAyB;AAC3BM,wBAAQC,GAAR,CAAY,UAAZ;AACAyB,qBAAK7B,WAAL,CAAiBK,MAAjB,GAA0B,UAA1B;AACH,aAHK,MAGD;AACDF,wBAAQC,GAAR,CAAY,SAAZ;AACAyB,qBAAK7B,WAAL,CAAiBK,MAAjB,GAA0B,SAA1B;AACH;AACD,gBAAIqE,SAASxG,GAAGyG,MAAH,CAAU,GAAV,EAAe9C,KAAKpD,MAAL,CAAYmG,qBAAZ,CAAkC1G,GAAGuD,EAAH,CAAM,CAAN,EAAS,CAAT,CAAlC,CAAf,CAAb;AACAI,iBAAK9B,QAAL,CAAc8E,SAAd,CAAwBH,MAAxB;AACH,SAlBD,EAkBG,CAlBH;AAoBH;AAxPI,CAAT","file":"game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["// Learn cc.Class:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\r\n// Learn Attribute:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\nlet mathUtil = require(\"util/mathUtil\");\r\nlet objectPool = require(\"util/objectPool\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        bg:cc.Node,\r\n        camera:cc.Node,\r\n        monster:cc.Node,\r\n        monsterScript:cc.Node,\r\n        controlOrignPosX:0,\r\n        controlOrignPosY:0,\r\n        moveSpeedX:0,\r\n        moveSpeedY:0,\r\n        fastSpeed:2,\r\n        starPrefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        monsterPrefab:{\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        obstacle1:cc.Node,\r\n        obstacle2:cc.Node,\r\n        obstacle3:cc.Node,\r\n        totalPlay:0,\r\n        allPlay:[cc.Prefab],\r\n        allStar:[cc.Prefab],\r\n        play1Stars:[cc.Prefab],\r\n        playNo:0,\r\n        gameOver:false,\r\n        standing:cc.Node,\r\n        resultLabel:cc.Label,\r\n        //enemyPrefab: cc.Prefab,\r\n        \r\n        // foo: {\r\n        //     // ATTRIBUTES:\r\n        //     default: null,        // The default value will be used only when the component attaching\r\n        //                           // to a node for the first time\r\n        //     type: cc.SpriteFrame, // optional, default is typeof default\r\n        //     serializable: true,   // optional, default is true\r\n        // },\r\n        // bar: {\r\n        //     get () {\r\n        //         return this._bar;\r\n        //     },\r\n        //     set (value) {\r\n        //         this._bar = value;\r\n        //     }\r\n        // },\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n     onLoad () {\r\n        console.log('game onLoad');\r\n        this.resultLabel.string = \"you lost\";\r\n        this.node.getChildByName('background').on(cc.Node.EventType.TOUCH_MOVE, this.touchMove, this);\r\n        this.node.getChildByName('background').on(cc.Node.EventType.TOUCH_START, this.touchStart, this);\r\n        this.node.getChildByName('background').on(cc.Node.EventType.TOUCH_END,this.touchEnd,this); \r\n        this.node.getChildByName('background').on(cc.Node.EventType.TOUCH_CANCEL,this.touchEnd,this); \r\n        this.initGame();\r\n    },\r\n    reStarGame(){\r\n        this.gameOver =  false;\r\n        console.log(\"this.allPlay.length=\",this.allPlay.length);\r\n        for(var i = 0;i < this.allPlay.length; i++){\r\n            let monster = this.allPlay[i];\r\n            if(monster!=null && monster!= undefined && !monster.isValid){\r\n                //monster.getComponent('monster').removeAllStar();\r\n               // objectPool.recoveryPlay(monster);\r\n               monster.destroy();\r\n            }\r\n               \r\n        }\r\n        this.standing.setPosition(cc.v2(320,2000));\r\n        cc.director.loadScene('game');\r\n    },\r\n    start () {\r\n        var self = this;\r\n        this.schedule(()=>{\r\n            let bg =self.node.children[0];\r\n            for(let i = 0; i<bg.children.length; i++){\r\n                let star = bg.children[i];\r\n                star.getComponent('cc.Collider').tag = -1;\r\n            }\r\n        }, 5);\r\n    },\r\n    /**\r\n     * 生命周期，销毁\r\n     */\r\n    onDestroy(){},\r\n    initGame(){\r\n        console.log('initGame');\r\n        for(var i = 0;i < this.totalPlay; i++){\r\n            \r\n            this.allPlay[i] = this.createMonster(10+i);\r\n            if(i == this.playNo){\r\n                this.monster = this.allPlay[i];\r\n                this.monsterScript = this.monster.getComponent('monster');\r\n                this.monsterScript.isCurrentPlayer = true;\r\n                this.camera.setPosition(this.monster.getPosition());\r\n            }else{\r\n                this.allPlay[i].getComponent('monster').AiOn();\r\n            }\r\n        }\r\n         //console.log(this.monster);\r\n        for(var ii = 0;ii < 24; ii++){\r\n           this.allStar[ii] = this.createStar();\r\n        }\r\n    },\r\n    createMonster:function(tag){\r\n        let monster = null;\r\n        monster =  objectPool.createPlay(this.monsterPrefab);\r\n        this.node.addChild(monster);\r\n        monster.getComponent('cc.Collider').tag = tag;\r\n        monster.getComponent('monster').game = this;\r\n        \r\n        if(this.allPlay.length>0){\r\n            var pos = this.getRandomPosition(0,0,1200,1200);\r\n            for(var i = 0;i<this.allPlay.length;i++){\r\n                let play = this.allPlay[i];\r\n                while(mathUtil.getDistance(pos,play.getPosition())<300){\r\n                    pos = this.getRandomPosition(0,0,1200,1200);\r\n                }\r\n                \r\n            }\r\n        }else{\r\n            monster.setPosition(this.getRandomPosition(0,300-600*(tag-10),1200,300));\r\n        }\r\n        //monster.setPosition(this.getRandomPosition(0,300-600*(tag-10),1200,300));\r\n        return monster;\r\n    },\r\n    createStar:function(){\r\n        let star = null;\r\n        star = objectPool.createStar(this.starPrefab);\r\n        try {\r\n        this.bg.addChild(star);\r\n        }catch(e){\r\n            return star;\r\n        }\r\n        star.getComponent('cc.Collider').tag = -1;\r\n        star.getComponent('star').game = this;\r\n        star.setPosition(this.getRandomPosition(0,0,1200,1200));\r\n        return star;\r\n    },\r\n    getRandomPosition:function(x,y,w,h){\r\n        var positionX = Math.floor(x+(Math.random()-0.5)*w);\r\n        var positionY = Math.floor(y+(Math.random()-0.5)*h);\r\n        var newV2 = cc.v2(positionX, positionY);\r\n        if(mathUtil.getDistance(newV2,this.obstacle1.getPosition())<200\r\n        ||mathUtil.getDistance(newV2,this.obstacle2.getPosition())<200\r\n        ||mathUtil.getDistance(newV2,this.obstacle3.getPosition())<200){\r\n            return this.getRandomPosition(x,y,w,h);\r\n        }else{\r\n            return newV2;\r\n        }\r\n        \r\n    },\r\n    updataMonsterStar(tag){\r\n        console.log(\"updataMonsterStar=\",tag);\r\n        this.allPlay[tag].getComponent('monster').reArrangeStar();\r\n    },\r\n    touchStart:function(event){\r\n        console.log('点击了');\r\n        this.controlOrignPosX = event.getLocationX();\r\n        this.controlOrignPosY = event.getLocationY();\r\n    },\r\n    touchMove:function(event){\r\n\r\n        if(this.monster != null || this.monster!= undefined){\r\n            if(this.gameOver){\r\n                this.monsterScript.move(0,0);\r\n            }else{\r\n                this.moveSpeedX = (event.getLocationX() - this.controlOrignPosX)/10;\r\n                if(this.moveSpeedX > this.fastSpeed){\r\n                        this.moveSpeedX = this.fastSpeed;\r\n                }else if(this.moveSpeedX < this.fastSpeed*-1){\r\n                        this.moveSpeedX = this.fastSpeed*-1;\r\n                }\r\n                this.moveSpeedY = (event.getLocationY() - this.controlOrignPosY)/10;\r\n                if(this.moveSpeedY>this.fastSpeed){\r\n                    this.moveSpeedY = this.fastSpeed;\r\n                }else if(this.moveSpeedY < this.fastSpeed*-1){\r\n                    this.moveSpeedY = this.fastSpeed*-1;\r\n                }\r\n                this.monsterScript.move(this.moveSpeedX,this.moveSpeedY);\r\n            }\r\n            \r\n        }\r\n       \r\n    },\r\n    touchEnd:function(event){\r\n        if(this.monster != null || this.monster!= undefined){\r\n            this.moveSpeedX = 0;\r\n            this.moveSpeedY = 0;\r\n            this.monsterScript.move(this.moveSpeedX,this.moveSpeedY);\r\n        }\r\n    },\r\n    addStarToMonster(node,tag){\r\n        this.monster.getComponent('monster').addStar(node);\r\n    },\r\n     update (dt) {\r\n     //  var posX = this.monster.x + this.moveSpeedX;\r\n      //  var posY = this.monster.y + this.moveSpeedY;\r\n        \r\n      /*   for(var i = 0;i<this.play1Stars.length;i++){\r\n            var x = this.play1Stars[i].x;\r\n            var y = this.play1Stars[i].y;\r\n            //console.log(\"monster (\"+this.monster.x+\",\"+this.monster.y+\")\");\r\n            //两点间距离\r\n            var dist = Math.sqrt(Math.pow((posX-x),2)+Math.pow((posY-y),2));\r\n           // console.log(dist);\r\n            \r\n        };*/\r\n        //this.monsterScript.move(this.moveSpeedX,this.moveSpeedY);\r\n        //this.monster.setPosition(new cc.v2(posX,posY));\r\n        if(this.monster != null || this.monster!= undefined){\r\n            this.camera.setPosition(this.monster.getPosition());\r\n        }\r\n        \r\n    },\r\n    finishPlay(tag){\r\n        console.log('tag=',tag); \r\n        this.allPlay.splice(tag-10,1);\r\n        if(this.gameOver)\r\n            return;\r\n        var self = this;\r\n        this.gameOver = true;\r\n        this.scheduleOnce(function() {\r\n            for(var i = 0;i<self.bg.children.length;i++){\r\n                objectPool.recoveryStar(self.bg.children[i]);\r\n            }\r\n           \r\n            console.log('tag ='+tag+\"_self.playNo=\"+self.playNo);\r\n            if(self.allPlay.length == 0){\r\n                console.log('a standoff');\r\n                self.resultLabel.string = \"a standoff\";\r\n            }else if(tag == self.playNo+10){\r\n                console.log('you lost');\r\n                self.resultLabel.string = \"you lost\";\r\n            }else{\r\n                console.log('you win');\r\n                self.resultLabel.string = \"you win\";\r\n            }\r\n            var action = cc.moveTo(0.5, self.camera.convertToWorldSpaceAR(cc.v2(0, 0)));\r\n            self.standing.runAction(action);\r\n        }, 1);\r\n        \r\n    }\r\n});\r\n"]}